# Spacefile Docs: https://go.deta.dev/docs/spacefile/v0
v: 0
app_name: "PingBack"
icon: "./assets/logo/v2_pingback-logo_deta@1024.png"
micros:
  - name: docs
    src: ./apps/docs
    path: docs
    public_routes:
      - "/*"
    engine: nodejs16
    commands:
    - export
    include:
      - bundled
      - server.js
      - package.json
    run: node server.js
    dev: yarn dev
  - name: space-app
    primary: true
    src: ./apps/space-app
    public_routes:
      - "/api/v*/events"
      - "/actions/live_feed"
    include:
      - bundled
      - package.json
    engine: nodejs16
    #commands:
    #- export
    #- export NODE_OPTIONS=--max-old-space-size=4096
    #- export
    #- npm install
    #- DETA_PROJECT_KEY=a0 NODE_OPTIONS=--max-old-space-size=4096 npm run build
    #- npm run build
    run: node bundled #build
    dev: vite dev --port $PORT
    # provide_actions: true
    # actions:
    #   - id: "cleanup_pushsubs"
    #     name: "Clean Push Subscriptions"
    #     description: "Cleans up push subscriptions from clients which havent been seen for a given amount of time."
    #     trigger: "schedule"
    #     default_interval: "0/1 * * * *"
    #     #default_interval: "50 11 * * *"
